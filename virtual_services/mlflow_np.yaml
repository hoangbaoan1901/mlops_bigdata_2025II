apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: mlflow-allow-ingress
  namespace: kubeflow
spec:
  podSelector:
    matchLabels:
      app: mlflow  # Ensure this label matches your MLflow pods
  policyTypes:
    - Ingress
  ingress:
    - from:
        # Allow traffic from Istio Ingress Gateway pods in istio-system namespace
        - namespaceSelector:
            matchLabels: # Using matchLabels is often cleaner if the namespace has a standard label
              kubernetes.io/metadata.name: istio-system # Or use the specific label your istio-system ns has

        # Optional: Allow traffic from any pod within the same 'kubeflow' namespace
        # This might already be covered by 'default-allow-same-namespace',
        # but explicitly adding it here ensures MLflow is accessible internally.
        - podSelector: {} # Allows from any pod in the 'kubeflow' namespace
        - namespaceSelector: {}
      ports:
        - protocol: TCP
          port: 5000 # The port your MLflow service/pods listen on